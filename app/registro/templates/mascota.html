{% extends 'base.html' %}
{% load django_bootstrap5 %}
{% load static %}

{% block title %}
  Todas las mascotas
{% endblock %}
{% block extra_head %}
  <script src="{% static 'js/jquery.min.js' %}"></script>
  <link rel="stylesheet" href="{% static 'css/leaflet.css' %}" />
  <script src="{% static 'js/leaflet.js' %}"></script>
  <style>
    .mascota-layout-row {
      min-height: 60vh;
      height: 100%;
      display: flex;
      flex-wrap: wrap;
    }
    .mascota-card-img {
      height: 220px;
      width: 220px;
      object-fit: cover;
      margin: auto;
      display: block;
    }
    @media (max-width: 768px) {
      .mascota-layout-row {
        flex-direction: column;
        min-height: unset;
      }
      .mascota-card-img {
        height: 160px;
        width: 160px;
      }
    }
    #mapa {
      width: 100%;
      height: 40vh;
      min-height: 200px;
      max-height: 400px;
      display: block;
    }
  </style>
{% endblock %}
{% block content %}
  <div class="container-fluid px-0">
    <div class="row mascota-layout-row gx-0">
      <!-- Foto de la mascota en Card -->
      <div class="col-12 col-md-4 d-flex align-items-center justify-content-center p-3">
        <div class="card w-100 h-100 shadow-sm">
          {% include 'registro/foto.html' with foto=registro.foto nombre=registro.nombre especie=registro.especie clase='card-img-top' %}
          <div class="card-body">
            <h5 class="card-title">{{ registro }}</h5>
            <p class="card-text">
              <strong>ID:</strong> {{ registro.id }}<br />
              <strong>Esterilizado en:</strong> {{ registro.inscripcion.campana.nombre }}<br />
              <small class="text-muted">Registrada: {{ registro.fecha_registro }}</small>
            </p>
          </div>
        </div>
      </div>
      <!-- Información de la mascota -->
      <div class="col-12 col-md-4 d-flex align-items-center justify-content-center p-3">
        <div class="w-100">
          <div class="mb-2">
            <strong>Cantón:</strong> {{ registro.get_canton_tutor_display }}
          </div>
          <div class="mb-2">
            <strong>Parroquia:</strong> {{ registro.get_parroquia_tutor_display }}
          </div>
          <div class="mb-2">
            <strong>Barrio:</strong> {{ registro.barrio_tutor }}
          </div>
          <div class="mb-2">
            <strong>Nº Turno:</strong> {{ registro.numero_turno }}
          </div>
          {% if registro.color_principal %}
            <div class="mb-2">
              <strong>Color:</strong> {{ registro.get_color_principal_display }}
              {% if registro.color_secundario %}
                | {{ registro.get_color_secundario_display }}
              {% endif %}
            </div>
          {% endif %}
          <div class="mb-2">
            <strong>Raza:</strong> {{ registro.raza_mascota }}
          </div>
        </div>
      </div>
      <!-- Mapa -->
      <div class="col-12 col-md-4 d-flex align-items-center justify-content-center p-3">
        <div class="w-100 h-100 bg-light p-3 rounded shadow-sm">
          <div id="mapa"></div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
{% block extra_body %}
  <script src="{% static 'js/mapa.js' %}"></script>
  <script>
    {% include "icono.html" %}
    $(function () {
      let mapInitialized = false
      const locaciones = [['{{registro.canton_tutor}}', '{{registro.parroquia_tutor}}', '{{registro.barrio_tutor}}', 1]]
      if (!mapInitialized) {
        mapInitialized = true
        inicializarMapa(locaciones, "{% static 'assets/locaciones.json' %}", icono)
      }
    })
  </script>
{% endblock %}
